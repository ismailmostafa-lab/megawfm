<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Submit Request</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  background:#f4f1fb;
  font-family:'Cairo',sans-serif;
}

.card{
  max-width:420px;
  margin:40px auto;
  padding:26px;
  border-radius:20px;
  background:white;
  box-shadow:0 8px 25px rgba(0,0,0,0.12);
}

.label{ font-weight:700; margin-top:14px; }
.input, .select{
  width:100%;
  padding:14px;
  margin-top:6px;
  border-radius:12px;
  border:1px solid #ddd;
  font-size:16px;
}

.btn{
  width:100%;
  padding:16px;
  margin-top:20px;
  border:none;
  border-radius:14px;
  color:white;
  font-size:17px;
  background:linear-gradient(135deg,#A666B0,#573B92);
}

.msg{ margin-top:15px; font-weight:700; text-align:center; }
</style>
</head>

<body>

<div class="card">

  <div class="label">Name</div>
  <input id="name" class="input" type="text" disabled>

  <div class="label">Calendar</div>
  <input id="date" class="input" type="date">

  <div class="label">Request Type</div>
  <select id="type" class="select">
    <option value="" disabled selected>Select Request Type</option>
    <option>Change Work Location</option>
    <option>Annual leave</option>
    <option>Permission 30 minute</option>
    <option>Permission 1 Hour</option>
    <option>Permission 2 Hours</option>
    <option>Permission 3 Hours</option>
    <option>Permission 4 Hours</option>
    <option>Sick Leave</option>
    <option>Emergency leave</option>
  </select>

  <button class="btn" onclick="submitRequest()">Submit</button>

  <div id="msg" class="msg"></div>

</div>

<script>
// If not logged in → redirect
if(!localStorage.getItem("ID")){
  window.location.href="login.html";
}

// load name into field
document.getElementById("name").value = localStorage.getItem("name");

const API = "YOUR_WEB_APP_URL";

async function submitRequest(){
  const name = localStorage.getItem("name");
  const id   = localStorage.getItem("ID");
  const date = document.getElementById("date").value;
  const type = document.getElementById("type").value;
  const msg  = document.getElementById("msg");

  if(!date || !type){
    msg.style.color="red";
    msg.textContent="Please complete all fields!";
    return;
  }

  msg.style.color="#666";
  msg.textContent="Submitting...";

  try{
    const url = `${API}?route=addLog&id=${id}&name=${encodeURIComponent(name)}&date=${date}&type=${encodeURIComponent(type)}`;

    const r = await fetch(url);
    const t = await r.text();

    if(t === "done"){
      msg.style.color="green";
      msg.textContent="Request submitted ✔";

      setTimeout(()=>{
        localStorage.removeItem("ID");
        localStorage.removeItem("name");
        window.location.href="login.html";
      },1500);

    } else {
      msg.style.color="red";
      msg.textContent="Error saving data!";
    }

  } catch(e){
    msg.style.color="red";
    msg.textContent="Connection Error!";
  }
}
</script>

</body>
</html>
