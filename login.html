<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Login — EPM</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  body{ margin:0; background:#f4eff8; font-family:"Cairo",sans-serif; }
  .card{
    max-width:560px;
    margin:80px auto;
    background:#fff;
    padding:36px;
    border-radius:18px;
    box-shadow:0 18px 40px rgba(87,59,146,0.10);
  }
  h2{ text-align:center; color:#6f2f90; margin:0 0 18px 0; font-size:28px; }
  .field{ margin-top:12px; }
  input{ width:100%; padding:14px 16px; border-radius:12px; border:1px solid #e6e0ea; font-size:16px; }
  .btn{
    width:100%; margin-top:20px; padding:14px; border:none; border-radius:12px;
    background:linear-gradient(135deg,#A666B0,#573B92); color:#fff; font-size:16px; cursor:pointer;
    box-shadow: 0 8px 20px rgba(111,47,144,0.18);
  }
  #msg{ text-align:center; margin-top:14px; font-weight:700; color:#d80000; }
</style>
</head>
<body>

<div class="card">
  <h2>Login</h2>

  <div class="field"><input id="id" type="text" placeholder="ID" autocomplete="username"></div>
  <div class="field"><input id="pass" type="password" placeholder="Password" autocomplete="current-password"></div>

  <button class="btn" onclick="doLogin()">Login</button>

  <div id="msg"> </div>
</div>

<script>
  // <<<< ضع هنا رابط ال Web App بعد ما تعمل Redeploy >>>>
  const API = "https://script.google.com/macros/s/AKfycbwCHjHcNiAFJ68F_GX2XrAsKFe0YkTZgF0AYokY7W3gDq99inb8QF14jAO4IlZiRWR3ng/exec";

  async function doLogin(){
    const id = document.getElementById("id").value.trim();
    const pass = document.getElementById("pass").value.trim();
    const msg = document.getElementById("msg");

    if(!id || !pass){
      msg.style.color="red"; msg.textContent="Please fill all fields"; return;
    }

    msg.style.color="#666"; msg.textContent="Checking...";

    try{
      // GET request expected by Apps Script
      const url = `${API}?route=login&id=${encodeURIComponent(id)}&pass=${encodeURIComponent(pass)}`;
      const r = await fetch(url);
      // try parse JSON (login returns JSON)
      const data = await r.json();

      if(data.status === "correct"){
        msg.style.color="green"; msg.textContent="Login Successful ✔";
        localStorage.setItem("ID", id);
        localStorage.setItem("name", data.name || "");
        setTimeout(()=>{ window.location.href = "logs.html"; }, 500);
      } else {
        msg.style.color="red"; msg.textContent="Invalid ID or Password";
      }

    } catch(err){
      console.error(err);
      msg.style.color="red";
      msg.textContent="Connection Error — check Redeploy / Sheet_ID / Permissions";
    }
  }
</script>

</body>
</html>
